WITH source AS (
SELECT DISTINCT
total,
feature_snippet_owned,
things_todo,
podcasts,
recipes_owned,
search_by_photos,
youtube_related_movies,
site_links,
knowledge_cards,
index,
youtube_video,
shopping,
thumbnails_owned,
youtube_radio,
featured_video,
youtube_show_owned,
https,
youtube_channel_owned,
results_about,
faq,
thumbnails,
youtube_movie_owned,
faq_owned,
youtube_playlist_owned,
maps_local_teaser,
tweets_owned,
reviews,
youtube_promoted_video_owned,
video,
id,
related_questions,
carousel,
youtube_secondary_search_container,
feature_snippet,
youtube_live_stream,
total_owned,
https_owned,
_sdc_table_version,
youtube_video_owned,
video_owned,
youtube_promoted_video,
job_posting,
knowledge_panel_owned,
keyword,
popular_products,
youtube_playlist,
ads_top,
related_questions_owned,
events,
apps,
_sdc_received_at,
youtube_related_to_your_search,
_sdc_sequence,
maps_local,
maps_local_owned,
direct_answer,
breadcrumbs_owned,
image_pack,
hotels_pack,
youtube_related_searches,
maps_local_teaser_owned,
created_at,
knowledge_panel,
page_serp_features_id,
youtube_shelf_render,
related_searches_carousel,
flights,
youtube_movie,
site_links_searchbox,
youtube_live_stream_owned,
featured_video_owned,
youtube_show,
most_popular_carousel,
refine_carousel,
tweets,
youtube_channel,
_sdc_batched_at,
reviews_owned,
youtube_ads,
trips_popular,
ads_bottom,
breadcrumbs,
site_links_searchbox_owned,
discover_more_places,
site_links_owned,
youtube_radio_owned,
recipes_position,
video_carousel_position,
news_position,
total__it,
total_owned__it,
page_serp_features_id__it,
date_period,
CAST(SAFE.SUBSTR(created_at, 0, 10)AS date) AS created_date,
row_number() over (PARTITION BY id order by date_period) AS row_number
from `client-enux`.`apiaccuranker`.`page_serp_features`
)

SELECT 
id,
total,
feature_snippet_owned,
things_todo,
podcasts,
recipes_owned,
search_by_photos,
youtube_related_movies,
site_links,
knowledge_cards,
youtube_video,
shopping,
thumbnails_owned,
youtube_radio,
featured_video,
youtube_show_owned,
https,
youtube_channel_owned,
results_about,
faq,
thumbnails,
youtube_movie_owned,
faq_owned,
youtube_playlist_owned,
maps_local_teaser,
tweets_owned,
reviews,
youtube_promoted_video_owned,
video,
related_questions,
carousel,
youtube_secondary_search_container,
feature_snippet,
youtube_live_stream,
total_owned,
https_owned,
youtube_video_owned,
video_owned,
youtube_promoted_video,
job_posting,
knowledge_panel_owned,
keyword,
popular_products,
youtube_playlist,
ads_top,
related_questions_owned,
events,
apps,
youtube_related_to_your_search,
maps_local,
maps_local_owned,
direct_answer,
breadcrumbs_owned,
image_pack,
hotels_pack,
youtube_related_searches,
maps_local_teaser_owned,
created_at,
knowledge_panel,
page_serp_features_id,
youtube_shelf_render,
related_searches_carousel,
flights,
youtube_movie,
site_links_searchbox,
youtube_live_stream_owned,
featured_video_owned,
youtube_show,
most_popular_carousel,
refine_carousel,
tweets,
youtube_channel,
_sdc_batched_at,
reviews_owned,
youtube_ads,
trips_popular,
ads_bottom,
breadcrumbs,
site_links_searchbox_owned,
discover_more_places,
site_links_owned,
youtube_radio_owned,
recipes_position,
video_carousel_position,
news_position,
total__it,
total_owned__it,
page_serp_features_id__it,
date_period
FROM source 
WHERE row_number = 1
